---
title: "NBA Shot Project"
author: "Chris Williams"
date: "August 20, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
```

```{r package}
library(tidyverse)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r read_data}
shots <- read_csv("nba_shots.csv")
player_names <- map_chr(shots$player_name, str_to_title)
shots$player_name <- player_names
# wait on this shots <- shots %>% mutate_if(is.character, as.factor)
str(shots)
shots_nested <- shots %>% group_by(GAME_ID) %>% nest()
totals <- read_csv("totals_1415.csv")
into_names <- names(totals) %>% str_split(",") %>% .[[1]]
names(totals) <- "x"
totals <- totals %>% separate(x, into_names, sep = ",")
totals <- as_data_frame(totals)
head(totals)
positions <- totals %>% select(c("Player", "Pos"))
head(positions)
## checking for missing values and get a sense of what is going on with the data including
## some exploratory analysis and visualization but also want to join with positions so 
## that the nearest defender length/size can be included
```

```{r explore_data}
nrow(positions)
n_distinct(positions$Player)
n_distinct(positions$Pos)
positions <- positions %>% distinct(Player, .keep_all = TRUE)
sum(is.na(positions$Player))
positions[which(is.na(positions$Player)),]
positions <- positions %>% drop_na() %>% mutate(rid = row_number())
##this was just a reference line of where the data came from in the totals df
unique(unlist(str_split(positions$Player, "")))
positions$Player <- str_replace_all(positions$Player, "\\\\.*", "")
bad_char <- positions[str_which(positions$Player, "[\\?\uFFFD]"),]
#qmark_player <- positions[str_which(positions$Player, "\\?"),]
#qmark_which <- str_which(positions$Player, "\\?")
#positions$Player <- str_replace_all(positions$Player, "\\?", "")
positions$Player <- if_else(str_detect(positions$Player, "\\?$"), str_replace(positions$Player, "\\?$", "c"), positions$Player)
#bad_char_which <- str_which(positions$Player, "[\\?\uFFFD]")
bad_char_remain <- positions[str_which(positions$Player, "[\\?\uFFFD]"),]
fixed_pname <- c("Alexis Ajinca", "Omer Asik", "Jose Calderon", "Francisco Garcia", "Manu Ginobili", "Jorge Gutierrez", "Nene Hilario", "Ersan Ilyasova", "Donatas Motiejunas", "Damjan Rudez", "Dennis Schroder", "Kevin Seraphin", "Hedo Turkoglu", "Jonas Valanciunas", "Anderson Varejao", "Greivis Vasquez", "Nikola Vucevic")
positions$Player <- plyr::mapvalues(positions$Player, from = bad_char_remain$Player, to = fixed_pname)
#ufffd_player <- positions[str_which(positions$Player, "\uFFFD"), ]
#ufffd_which <- str_which(positions$Player, "\uFFFD")
#positions$Player <- str_replace_all(positions$Player, "\uFFFD", "")
unique(unlist(str_split(positions$Player, "")))
View(positions)
mult_pos <- positions[str_which(positions$Pos, "[^A-Z]"),]
mult_pos1 <- positions[str_which(positions$Pos, ".{3,}"),]
#although position does not guarentee height the further from the positions should represent "mismatch" scenarios, was unable to find player height in a useable format.
#end note = go back and examine players with missing and/or incorrect characters to fix their names
shots %>% group_by(player_name) %>% nest() %>% n_distinct(.$player_name)
player_list <- shots %>% group_by(player_name) %>% summarize(cnt = sum(FGM))
positions <- rename(positions, "player_name" = "Player")
View(positions)
no_match_shots <- shots %>% group_by(player_name) %>% nest() %>% anti_join(positions, by = "player_name") %>% select(player_name)
no_match_pos <- positions %>% anti_join(shots, by = "player_name") %>% select(player_name)
fixed_pname_2 <- c("Joe Ingles", "DeMarre Carroll", "Jimmer Fredette", "Monta Ellis", "J.J. Barea", "Al-Farouq Aminu", "Dirk Nowitzki", "Kyle O'Quinn", "LeBron James", "C.J. Watson", "C.J. Miles", "Danilo Gallinari", "J.J. Hickson", "P.J. Tucker", "Nerlens Noel", "K.J. McDaniels", "JaKarr Sampson", "Luc Mbah a Moute", "O.J. Mayo", "Beno Udrih", "Amar'e Stoudemire", "Tim Hardaway", "D.J. Augustin", "Dwyane Wade", "Ray McCallum", "Ben McLemore", "DeMarcus Cousins", "Steven Adams", "J.J. Redick", "DeAndre Jordan", "CJ McCollum", "LaMarcus Aldridge", "Allen Crabbe", "Zach LaVine")
shots$player_name <- plyr::mapvalues(shots$player_name, from = no_match_shots$player_name, to = fixed_pname_2)
shots %>% group_by(player_name) %>% nest() %>% anti_join(positions, by = "player_name") %>% select(player_name)
shots %>% group_by(player_name) %>% nest() %>% semi_join(positions, by = "player_name") %>% n_distinct(.$player_name)
map(shots, ~sum(is.na(.))) %>% unlist()
shots_nest_player <- shots %>% group_by(player_name) %>% nest()
#recoded the names without a match then ensured that the join was successful, shots is now 
```
